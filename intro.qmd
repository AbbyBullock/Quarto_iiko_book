---
editor_options: 
  chunk_output_type: console
  filters: output-folding
---

# Отчет о продажах за период

## Меню "Все сейчас хорошо"

Начнем с анализа меню ресторана "Все сейчас хорошо", так как на данный момент это является акутальным для нас.

На первом шаге мы загрущзим данные и оставим только те позиции, которые относятся к меню "ВСХ". Все позиции меню данного ресторана обозначены "ВСХ \<наименования позиции меню\>".

```{r}
#| include: false
library(tidyverse)
library(lubridate)
library(hms)
library(dtplyr)
library(patchwork)
library(vroom)
library(gt)
library(gghighlight)

sales_iiko <- vroom("/Users/abbybullock/Library/Mobile Documents/com~apple~CloudDocs/DDM/Git/iiko/sales_iiko.csv")
VSH <- sales_iiko %>% 
  filter(str_detect(food_name, "ВСХ"))
```

Посмотрим на структуру данных

```{r}
#| echo: false
#| fig-align: center
VSH %>% head(20)
```

Данные представлены с `r min(VSH$date)` по `r max(VSH$date)`. В них содержится 20 колонок. Не все они требуют пояснения.

::: {.callout-note appearance="simple"}
## Заметка

Мы детально рассмотрим только те колонки, которые требуют внимания
:::

-   **`code`** - код наменклатуры (SKU) в iiko

-   **`group`** - группа первого уровня в iiko

-   **`food_name`** - наименоание позиции в меню

-   **`count`** - количество реализованнх SKU в конкретный день

-   **`revenue_no_sale`** - выручка без скидок в конкретный день по конкретному SKU

-   **`sum_sale`** - сумма скидок в рублях

-   **`revenue`** - выручка за вычитом скидок

-   **`food_cost`** - фудкост рассчитанный в iiko

-   **`allowance`** - наценка

-   **`discount_rate`** - размер скидки. Данная переменая нужна, чтобы рассчитать реальный фудкост, где не будут учтены наценки за обслуживания

-   **`revenue_end`** - очищенная выручка от наценок

-   **`food_cost_end`** - расчитанный фудкост

Посморим какие группы меню содержатся в наших данных

```{r}
#| echo: false
#| fig-align: center
VSH %>% 
  count(group, sort = TRUE)
```

Добавим в наши данные еще одну колонку, которая будет содержать тип группы: "Еда" или "Бар" и посмотрим на соотношение количества и суммы продаж по двум этим параметрам.

```{r}
#| include: false
VSH <- VSH %>% 
  mutate(
    group_2 = case_when(
      str_detect(group, "КОКТЕЙЛИ|КОФЕ|ЛИМОНАДЫ|ЧАЙ|ПИВО|НАСТОЙКИ|СОК|МИЛКШЕЙКИ|АЛКОГОЛЬ|ВИНО|Кофе|БАР") ~ "Бар",
      TRUE ~ "Еда")
    )
```

```{r}
#| echo: false
#| fig-align: center
VSH %>%
  group_by(group_2) %>% 
  summarise(Количество = sum(count),
            Сумма_продаж = sum(revenue_end))
```

Мы видим, что с `r min(VSH$date)` по `r max(VSH$date)` еды было продано больше, чем позиций бара. Но по сумме выручки -- цифры сопоставимые.

### Динамика продаж {.unnumbered}

Посмотрим на динамику продаж по этим двум группам.

```{r}
#| echo: false
#| warning: false
#| fig-width: 7
#| fig-align: center
VSH %>% 
  mutate(date = round_date(date, "month")) %>% 
  group_by(date, group_2) %>% 
  summarise(
    count = sum(count)
  ) %>% 
  ungroup() %>% 
  ggplot(aes(date, count, col = group_2)) +
  geom_line() +
  geom_point(size = 1) +
  theme_light() +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = -1,
            size = 1.7,
            alpha = 1,
            col = "black") +
  theme(legend.position = "bottom",
        legend.title = element_blank()) +
  xlab("Месяц") +
  ylab("Кол-во проданных SKU") +
  ggtitle("Кол-во проданных SKU",
          subtitle = "Бар и еда") +
  theme(axis.text.x = element_text(angle = 0, size = 5))
```

```{r}
#| echo: false
#| warning: false
#| fig-width: 7
#| fig-height: 7
#| fig-align: center
VSH %>% 
  mutate(date = round_date(date, "month")) %>% 
  group_by(date, group_2) %>% 
  summarise(
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  ggplot(aes(date, rev, col = group_2)) +
  geom_line() +
  geom_point(size = 1) +
  theme_light() +
  scale_y_continuous(n.breaks = 10) +
  geom_text(aes(label = rev),
            position = position_dodge(width = 0), vjust = -1,
            size = 1.7,
            alpha = 1,
            col = "black") +
  theme(legend.position = "none") +
  xlab("Месяц") +
  ylab("Выручка по проданным SKU") +
  ggtitle("Сумма выручки по SKU",
          subtitle = "Бар и еда") +
  theme(axis.text.x = element_text(angle = 0, size = 5)) +
  facet_wrap(~group_2, nrow = 2) +
  geom_smooth(size = 0.4,
              linetype = "dashed",
              alpha = 0.1)
```

Мы видим, что динамика продаж отрицательная. Сложно сделать окончательные выводы, по имеющимся данным, так как у нас их недостаточно. Возможно отрицательная динамика -- это всего лишь сезонность.

При этом стоит отметить, что продажи бара менее вариабельны, чем позиции по кухне.

#### Динамика foodcost по группам в меню {.unnumbered}

```{r}
#| echo: false
#| warning: false
#| fig-width: 7
#| fig-height: 7
#| fig-align: center
VSH %>% 
  filter(revenue_end > 0) %>% 
  mutate(date = round_date(date, "month")) %>% 
  group_by(date, group_2) %>% 
  summarise(
    food_cost_end = mean(food_cost_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_cost_end = round(food_cost_end, 2)) %>% 
  ggplot(aes(date, food_cost_end, col = group_2)) +
  geom_line() +
  geom_point(size = 1) +
  theme_light() +
  scale_y_continuous(n.breaks = 10) +
  geom_text(aes(label = food_cost_end),
            position = position_dodge(width = 0), vjust = -1,
            size = 1.7,
            alpha = 1,
            col = "black") +
  theme(legend.position = "none") +
  xlab("Месяц") +
  ylab("Foodcost") +
  ggtitle("Средний foodcost",
          subtitle = "Бар и еда") +
  theme(axis.text.x = element_text(angle = 0, size = 5)) +
  facet_wrap(~group_2, nrow = 2) +
  geom_smooth(size = 0.4,
              linetype = "dashed",
              alpha = 0.1)
```

#### Популярные позиции меню {.unnumbered}

Теперь мы можем посмотреть на те позиции, которые наиболее часто покупают в "ВСХ". Нас больше интересует не сама группа, а конкретное SKU.

Сначала посмотрим на позиции, которые относятся к категории "Еда". Выделим ТОП 50

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Еда",
    !str_detect(group, "ДОП")
         ) %>% 
  group_by(food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, count, .desc = FALSE)) %>% 
  top_n(n = 50, wt = count) %>% 
  ggplot(aes(count, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Кол-во проданных SKU за весь период иследования",
          subtitle = "SKU еда - TOP 50") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

Теперь выделим TOP 50 позиций бара:

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Бар",
  ) %>% 
  group_by(food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, count, .desc = FALSE)) %>% 
  top_n(n = 50, wt = count) %>% 
  ggplot(aes(count, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Кол-во проданных SKU за весь период иследования",
          subtitle = "SKU бар - TOP 50") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

::: {.callout-caution appearance="simple"}
## Обратите внимание

Данная ифонрмация представлена за весь период работы бара "Все сейчас хорошо"
:::

Давайте посмотрим на продажи позиций из меню за последние 3 мес. Таким образмо, мы полчим только те SKU, которые есть в меню.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Еда",
    year == 2022 & month >= 7
  ) %>% 
  group_by(group_2, food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, count, .desc = FALSE)) %>% 
  ggplot(aes(count, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Кол-во проданных SKU c июля по сентбярь 2022 года",
          subtitle = "SKU ЕДА") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

Посмотрим на выручкку по этим же параметрам

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Еда",
    year == 2022 & month >= 7
  ) %>% 
  group_by(group_2, food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, rev, .desc = FALSE)) %>% 
  ggplot(aes(rev, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = rev),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Выручка по SKU c июля по сентбярь 2022 года",
          subtitle = "SKU ЕДА") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

Предтавим данные в таблице.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Еда",
    year == 2022 & month >= 7
  ) %>% 
  group_by(month, food_name) %>% 
  summarise(
    rev = sum(revenue_end)
  ) %>% 
  pivot_wider(names_from = month, values_from = rev)
```

Судя по данным, на мой взгляд, позиции, которые выходят в ТОП, связаны с детскими лагерями.

Отдельно рассмотрим позиции бара "ВСХ" за теже три месяца.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Бар",
    year == 2022 & month >= 7
  ) %>% 
  group_by(group_2, food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, count, .desc = FALSE)) %>% 
  ggplot(aes(count, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Кол-во проданных SKU c июля по сентбярь 2022 года",
          subtitle = "SKU ЕДА") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

Посмотрим на выручкку по этим же параметрам

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Бар",
    year == 2022 & month >= 7
  ) %>% 
  group_by(group_2, food_name) %>% 
  summarise(
    count = sum(count),
    rev = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(food_name = fct_reorder(food_name, rev, .desc = FALSE)) %>% 
  ggplot(aes(rev, food_name, fill = food_name)) +
  geom_col(alpha = 0.7) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = rev),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 1.7,
            alpha = 1,
            col = "black") +
  xlab("Кол-во проданных SKU") +
  ylab("") +
  ggtitle("Выручка по SKU c июля по сентбярь 2022 года",
          subtitle = "SKU ЕДА") +
  theme(axis.text.y = element_text(angle = 0, size = 5))
```

Предтавим данные в таблице.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
VSH %>% 
  filter(
    group_2 == "Бар",
    year == 2022 & month >= 7
  ) %>% 
  group_by(month, food_name) %>% 
  summarise(
    rev = sum(revenue_end)
  ) %>% 
  pivot_wider(names_from = month, values_from = rev)
```

## Меню ресторана #proСчастье

### Бар {.unnumbered}

```{r}
#| include: false
drinks_pro <- vroom("/Users/abbybullock/Library/Mobile Documents/com~apple~CloudDocs/DDM/Git/iiko/drinks_pro.csv")
```

В данном разделе мы проанализируем продажи барного меню ресторана #proСчастье. У нас есть данные за период с `r min(drinks_pro$date)` по `r max(drinks_pro$date)`. Нам инетресен промежуток с июня 2022 по `r max(drinks_pro$date)`.

На первом этапе посмотрим, какие группы меню наиболее востребованы. Рассмотрим весь период, имеющийся в данных.

**Количество проданных групп SKU по годам**

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
drinks_pro %>% 
  group_by(year, group) %>% 
  summarise(
    count = sum(count)
  ) %>% 
  ungroup() %>% 
  mutate(group = fct_reorder(group, count, .desc = FALSE)) %>% 
  ggplot(aes(factor(year), group, fill = count)) +
  geom_tile() +
  scale_fill_gradient2(
    low = "#800000",
    mid = "#2F4F4F",
    high = "#CD853F"
    ) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 4,
            alpha = 1,
            col = "#FFFFE0") +
  xlab("Год") +
  ylab("Группа меню") +
  ggtitle("Кол-во проданных SKU",
          subtitle = "с 2017 по 2022")
```

**Выручка проданных групп SKU по годам**

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
drinks_pro %>% 
  group_by(year, group) %>% 
  summarise(
     revenue = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(group = fct_reorder(group, revenue, .desc = FALSE)) %>% 
  ggplot(aes(factor(year), group, fill = revenue)) +
  geom_tile() +
  scale_fill_gradient2(
    low = "#800000",
    mid = "#2F4F4F",
    high = "#CD853F"
    ) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 3.5,
            alpha = 1,
            col = "#FFFFE0") +
  xlab("Год") +
  ylab("Группа меню") +
  ggtitle("Выручка ппо SKU",
          subtitle = "с 2017 по 2022")
```

**Средний foodcost проданных групп SKU по годам**

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
drinks_pro %>% 
  group_by(year, group) %>% 
  summarise(
     food_cost = mean(food_cost_end)
  ) %>% 
  ungroup() %>% 
  mutate(group = fct_reorder(group, food_cost, .desc = FALSE),
         food_cost = round(food_cost, 2)) %>% 
  ggplot(aes(factor(year), group, fill = food_cost)) +
  geom_tile() +
  scale_fill_gradient2(
    low = "#800000",
    mid = "#2F4F4F",
    high = "#008080"
    ) +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = food_cost),
            position = position_dodge(width = 0), vjust = 0.2,
            size = 3.5,
            alpha = 1,
            col = "#FFFFE0") +
  xlab("Год") +
  ylab("Группа меню") +
  ggtitle("Средний фудкост по  SKU",
          subtitle = "с 2017 по 2022")
```

Давайте посмотри на динамику продаж по группам в течение 2022 года.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
drinks_pro %>% 
  mutate(date = round_date(date, "month")) %>% 
  group_by(date) %>% 
  summarise(
     revenue = sum(revenue_end)
  ) %>% 
  ungroup() %>% 
  mutate(revenue = round(revenue, 0)) %>% 
  ggplot(aes(date, revenue)) +
  geom_line(col = "coral") +
  geom_point(col = "coral") +
  theme_light() +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -1,
            size = 1.7,
            alpha = 1,
            col = "black") +
  theme(legend.position = "bottom",
        legend.title = element_blank()) +
  scale_y_continuous(n.breaks = 15) +
  xlab("Месяц") +
  ylab("Выручка") +
  ggtitle("Продажи в рублях",
          subtitle = "барное меню") +
  theme(axis.text.x = element_text(angle = 0, size = 5)) +
  geom_smooth(size = 0.4,
              linetype = "dashed",
              alpha = 0.1)
```

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
drinks_pro %>% 
  mutate(date = round_date(date, "month")) %>% 
  group_by(date) %>% 
  summarise(
     count = sum(count)
  ) %>% 
  ungroup() %>% 
  ggplot(aes(date, count)) +
  geom_line(col = "coral") +
  geom_point(col = "coral") +
  theme_light() +
  geom_text(aes(label = count),
            position = position_dodge(width = 0), vjust = -1,
            size = 1.7,
            alpha = 1,
            col = "black") +
  theme(legend.position = "bottom",
        legend.title = element_blank()) +
  scale_y_continuous(n.breaks = 15) +
  xlab("Месяц") +
  ylab("Выручка") +
  ggtitle("Продажи в штуках",
          subtitle = "барное меню") +
  theme(axis.text.x = element_text(angle = 0, size = 5)) +
  geom_smooth(size = 0.4,
              linetype = "dashed",
              alpha = 0.1)
```

В целом мы видим отрицательную динамику с теченим времени как по выручке, так и по количеству продаваемых позиций бара.

Давайте посмотрим какую долю занимает каждая группа в продажах.

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center

drinks_pro %>% 
  summarise(revenue = sum(revenue_end),
            .by = group) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    group = fct_reorder(group, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(group, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группам барного меню",
          subtitle = "период с 2017 по октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

90% продаж приходится на позиции выделенные цветом.

Отдельно посмотрим на долю продаж только за 2022 год

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center

drinks_pro %>% 
  filter(year == 2022) %>% 
  group_by(group) %>% 
  summarise(revenue = sum(revenue_end)) %>% 
  ungroup() %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    group = fct_reorder(group, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(group, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группам барного меню",
          subtitle = "период январь - декабрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

drinks_pro %>% 
  filter(year == 2022) %>% 
  group_by(group) %>% 
  summarise(revenue = sum(revenue_end)) %>% 
  ungroup() %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    group = fct_reorder(group, revenue, .desc = TRUE)
  ) %>%
  arrange(desc(revenue)) %>% 
  mutate(
    cs = cumsum(ratio)
    ) %>%
  ggplot(aes(group, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  scale_y_continuous(n.breaks = 15) +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 2,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("") +
  ggtitle("Доля продаж по группам барного меню в абсолютных цифрах",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

95% продаж приходится на позиции выделенные цветом.

::: {.callout-caution appearance="simple"}
## Обратите внимание

Далее на графиках выделенное цветом соответсвует 95% продаж
:::

### Детализация по группам меню бара {.unnumbered}

```{r}
#| include: false
bar_group <- drinks_pro %>% 
  filter(
    year == 2022
  ) %>% 
  group_by(group, food_name) %>% 
  summarise(revenue = sum(revenue_end)) %>% 
  ungroup() %>%
  arrange(desc(revenue))
```

::: panel-tabset
## Пиво

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group =="ПИВО"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ПИВО",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group =="ПИВО"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ПИВО",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Напитки

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group =="НАПИТКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе НАПИТКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group =="НАПИТКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе НАПИТКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Коктейли алк

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "КОКТЕЙЛИ АЛК"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе КОКТЕЙЛИ АЛК",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "КОКТЕЙЛИ АЛК"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе КОКТЕЙЛИ АЛК",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Кофе

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "КОФЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе КОФЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "КОФЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе КОФЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Виски

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИСКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИСКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИСКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИСКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Водка

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВОДКА"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВОДКА",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВОДКА"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВОДКА",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Чай

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2

bar_group %>% 
  filter(
    group == "ЧАЙ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ЧАЙ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ЧАЙ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ЧАЙ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вино игристое

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИНО ИГРИСТОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИНО ИГРИСТОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИНО ИГРИСТОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИНО ИГРИСТОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вино белое

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИНО БЕЛОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИНО БЕЛОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИНО БЕЛОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИНО БЕЛОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вина по бокалам

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИНА ПО БОКАЛАМ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИНА ПО БОКАЛАМ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИНА ПО БОКАЛАМ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИНА ПО БОКАЛАМ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Коньяк

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "КОНЬЯК"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе КОНЬЯК",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "КОНЬЯК"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе КОНЬЯК",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Коктейли б/а

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "КОКТЕЙЛИ БЕЗАЛКОГОЛЬНЫЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе КОКТЕЙЛИ БЕЗАЛКОГОЛЬНЫЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "КОКТЕЙЛИ БЕЗАЛКОГОЛЬНЫЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе КОКТЕЙЛИ БЕЗАЛКОГОЛЬНЫЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вино красное

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИНО КРАСНОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИНО КРАСНОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИНО КРАСНОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИНО КРАСНОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Свежевыжатые соки

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "СВЕЖЕВЫЖАТЫЕ СОКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе СВЕЖЕВЫЖАТЫЕ СОКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "СВЕЖЕВЫЖАТЫЕ СОКИ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе СВЕЖЕВЫЖАТЫЕ СОКИ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Лимонады

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ЛИМОНАДЫ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ЛИМОНАДЫ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ЛИМОНАДЫ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ЛИМОНАДЫ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Биттер

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "БИТТЕР"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе БИТТЕР",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "БИТТЕР"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе БИТТЕР",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Текила

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ТЕКИЛА"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ТЕКИЛА",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ТЕКИЛА"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ТЕКИЛА",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Ликеры

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ЛИКЕРЫ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ЛИКЕРЫ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ЛИКЕРЫ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ЛИКЕРЫ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Бар

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "БАР"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе БАР",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "БАР"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе БАР",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вино розовое

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВИНО РОЗОВОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВИНО РОЗОВОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВИНО РОЗОВОЕ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВИНО РОЗОВОЕ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```

## Вермут

```{r}
#| echo: false
#| warning: false
#| fig-width: 12
#| fig-height: 8
#| fig-align: center
#| layout-ncol: 2
bar_group %>% 
  filter(
    group == "ВЕРМУТ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, ratio)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = ratio),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Доля продаж по группе ВЕРМУТ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)

bar_group %>% 
  filter(
    group == "ВЕРМУТ"
  ) %>% 
  mutate(
    ratio = sum(revenue),
    ratio = round(revenue/ratio*100, 1),
    food_name = fct_reorder(food_name, ratio, .desc = TRUE)
  ) %>%
  arrange(desc(ratio)) %>% 
  mutate(cs = cumsum(ratio)) %>%
  ggplot(aes(food_name, revenue)) +
  geom_col(fill = "#5F9EA0") +
  theme_light() +
  theme(legend.position = "none") +
  geom_text(aes(label = revenue),
            position = position_dodge(width = 0), vjust = -0.5,
            size = 3,
            alpha = 1,
            col = "black") +
  xlab("") +
  ylab("Доля %") +
  ggtitle("Продажи по группе ВЕРМУТ",
          subtitle = "период январь - октябрь 2022") +
  theme(axis.text.y = element_text(angle = 0, size = 5)) +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  gghighlight(cs <= 95)
```
:::
